<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 What is SWIM? | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis</title>
  <meta name="description" content="2 What is SWIM? | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 What is SWIM? | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="spesenti/SWIMvignette" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 What is SWIM? | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis" />
  
  
  

<meta name="author" content="Silvana M. Pesenti 2, Alberto Bettini3, Pietro Millossovich4,5, Andreas Tsanakas5" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="Sec-Scope.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="assets/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#background-and-contribution"><i class="fa fa-check"></i><b>1.1</b> Background and contribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#structure-of-the-paper"><i class="fa fa-check"></i><b>1.3</b> Structure of the paper</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Sec-Intro.html"><a href="Sec-Intro.html"><i class="fa fa-check"></i><b>2</b> What is <strong>SWIM</strong>?</a><ul>
<li class="chapter" data-level="2.1" data-path="Sec-Intro.html"><a href="Sec-Intro.html#sensitivity-testing-and-scenario-weights"><i class="fa fa-check"></i><b>2.1</b> Sensitivity testing and scenario weights</a></li>
<li class="chapter" data-level="2.2" data-path="Sec-Intro.html"><a href="Sec-Intro.html#an-introductory-example"><i class="fa fa-check"></i><b>2.2</b> An introductory example</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Sec-Scope.html"><a href="Sec-Scope.html"><i class="fa fa-check"></i><b>3</b> Scope of the <strong>SWIM</strong> package</a><ul>
<li class="chapter" data-level="3.1" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Rfunctions"><i class="fa fa-check"></i><b>3.1</b> Stressing a model</a><ul>
<li class="chapter" data-level="3.1.1" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Rstress"><i class="fa fa-check"></i><b>3.1.1</b> The <code>stress</code> function and the <strong>SWIM</strong> object</a></li>
<li class="chapter" data-level="3.1.2" data-path="Sec-Scope.html"><a href="Sec-Scope.html#stressing-disjoint-probability-intervals"><i class="fa fa-check"></i><b>3.1.2</b> Stressing disjoint probability intervals</a></li>
<li class="chapter" data-level="3.1.3" data-path="Sec-Scope.html"><a href="Sec-Scope.html#stressing-moments"><i class="fa fa-check"></i><b>3.1.3</b> Stressing moments</a></li>
<li class="chapter" data-level="3.1.4" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Sec:RiskMeasures"><i class="fa fa-check"></i><b>3.1.4</b> Stressing risk measures</a></li>
<li class="chapter" data-level="3.1.5" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Sec:User"><i class="fa fa-check"></i><b>3.1.5</b> User defined scenario weights</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Sec:analysis"><i class="fa fa-check"></i><b>3.2</b> Analysis of stressed models</a><ul>
<li class="chapter" data-level="3.2.1" data-path="Sec-Scope.html"><a href="Sec-Scope.html#distributional-comparison"><i class="fa fa-check"></i><b>3.2.1</b> Distributional comparison</a></li>
<li class="chapter" data-level="3.2.2" data-path="Sec-Scope.html"><a href="Sec-Scope.html#sensitivity-measures"><i class="fa fa-check"></i><b>3.2.2</b> Sensitivity measures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html"><i class="fa fa-check"></i><b>4</b> Case study</a><ul>
<li class="chapter" data-level="4.1" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#a-credit-risk-portfolio"><i class="fa fa-check"></i><b>4.1</b> A credit risk portfolio</a></li>
<li class="chapter" data-level="4.2" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#stressing-the-portfolio-loss"><i class="fa fa-check"></i><b>4.2</b> Stressing the portfolio loss</a></li>
<li class="chapter" data-level="4.3" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#analysing-stressed-models"><i class="fa fa-check"></i><b>4.3</b> Analysing stressed models</a></li>
<li class="chapter" data-level="4.4" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#visualising-stressed-distributions"><i class="fa fa-check"></i><b>4.4</b> Visualising stressed distributions</a></li>
<li class="chapter" data-level="4.5" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#sensitivity-measures-1"><i class="fa fa-check"></i><b>4.5</b> Sensitivity measures</a></li>
<li class="chapter" data-level="4.6" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#constructing-more-advanced-stresses"><i class="fa fa-check"></i><b>4.6</b> Constructing more advanced stresses</a><ul>
<li class="chapter" data-level="4.6.1" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#sensitivity-of-default-probabilities"><i class="fa fa-check"></i><b>4.6.1</b> Sensitivity of default probabilities</a></li>
<li class="chapter" data-level="4.6.2" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#stressing-tails-of-subportfolios"><i class="fa fa-check"></i><b>4.6.2</b> Stressing tails of subportfolios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="conclusion-and-future-work.html"><a href="conclusion-and-future-work.html"><i class="fa fa-check"></i><b>5</b> Conclusion and future work</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="AppendixCM.html"><a href="AppendixCM.html"><i class="fa fa-check"></i><b>A</b> Appendix Credit Model</a><ul>
<li class="chapter" data-level="A.1" data-path="AppendixCM.html"><a href="AppendixCM.html#credit-model-assumptions"><i class="fa fa-check"></i><b>A.1</b> Credit Model assumptions</a></li>
<li class="chapter" data-level="A.2" data-path="AppendixCM.html"><a href="AppendixCM.html#code-for-generating-the-data"><i class="fa fa-check"></i><b>A.2</b> Code for generating the data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Scenario Weights for Importance Measurement (<strong>SWIM</strong>) – an <strong>R</strong> package for sensitivity analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Sec:Intro" class="section level1">
<h1><span class="header-section-number">2</span> What is <strong>SWIM</strong>?</h1>
<div id="sensitivity-testing-and-scenario-weights" class="section level2">
<h2><span class="header-section-number">2.1</span> Sensitivity testing and scenario weights</h2>
<p>The purpose of <strong>SWIM</strong> is to enable sensitivity analysis of models implemented in a Monte Carlo simulation framework, by distorting (<em>stressing</em>) some of the models’ components and monitoring the resulting impact on quantities of interest.
To clarify this idea and explain how <strong>SWIM</strong> works, we first define the terms used. By a <em>model</em>, we mean a set of <span class="math inline">\(n\)</span> (typically simulated) realisations from a vector of random variables <span class="math inline">\((X_1,\dots,X_d)\)</span>, along with <em>scenario weights</em> <span class="math inline">\(W\)</span> assigned to individual realisations, as shown in Table <a href="Sec-Intro.html#tab:SWIMframework">2.1</a>. Hence each of the columns 1 to <span class="math inline">\(d\)</span> corresponds to a random variable, called a <em>model component</em>, while each row corresponds to a <em>scenario</em>, that is, a state of the world.</p>
<p>There is a conceptual distinction between the model from which the scenarios are simulated and the model as understood here. Specifically, as we are considering the case when an analyst has access to simulated scenarios only, and not the data-generating mechanism, we are consistently working with the empirical probability measure and any expectations or probabilities stated below are given with respect to that measure. Furthermore, as we work on an empirical space, we systematically conflate a random variable with its vector of realisations – in particular, the scenario weights <span class="math inline">\(W\)</span> can be identified with a Radon-Nikodym on that space. For relevant notation on the space we are working on, see Section <a href="Sec-Scope.html#Sec:Scope">3</a>.</p>
<table>
<caption><span id="tab:SWIMframework">Table 2.1: </span> Illustration of the <strong>SWIM</strong> framework, that is the baseline model, the stressed model and the scenario weights.</caption>
<thead>
<tr class="header">
<th align="center"><span class="math inline">\(X_1\)</span></th>
<th align="right"><span class="math inline">\(X_2\)</span></th>
<th align="right"><span class="math inline">\(\dots\)</span></th>
<th align="right"><span class="math inline">\(X_d\)</span></th>
<th align="right"><span class="math inline">\(W\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><span class="math inline">\(x_{11}\)</span></td>
<td align="right"><span class="math inline">\(x_{21}\)</span></td>
<td align="right"><span class="math inline">\(\dots\)</span></td>
<td align="right"><span class="math inline">\(x_{d1}\)</span></td>
<td align="right"><span class="math inline">\(w_1\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(x_{12}\)</span></td>
<td align="right"><span class="math inline">\(x_{22}\)</span></td>
<td align="right"><span class="math inline">\(\dots\)</span></td>
<td align="right"><span class="math inline">\(x_{d2}\)</span></td>
<td align="right"><span class="math inline">\(w_2\)</span></td>
</tr>
<tr class="odd">
<td align="center"><span class="math inline">\(\vdots\)</span></td>
<td align="right"><span class="math inline">\(\vdots\)</span></td>
<td align="right"><span class="math inline">\(\ddots\)</span></td>
<td align="right"><span class="math inline">\(\vdots\)</span></td>
<td align="right"><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="even">
<td align="center"><span class="math inline">\(x_{1n}\)</span></td>
<td align="right"><span class="math inline">\(x_{2n}\)</span></td>
<td align="right"><span class="math inline">\(\dots\)</span></td>
<td align="right"><span class="math inline">\(x_{dn}\)</span></td>
<td align="right"><span class="math inline">\(w_n\)</span></td>
</tr>
</tbody>
</table>
<p>Each scenario has a <em>scenario weight</em>, shown in the last column, such that, scenario <span class="math inline">\(i\)</span> has probability <span class="math inline">\(\frac{w_i}{n}\)</span> of occurring. Scenario weights are always greater or equal than zero and have an average of 1. When all scenario weights are equal to 1, such that the probability of each scenario is <span class="math inline">\(\frac 1 n\)</span> (the standard Monte Carlo framework), we call the model a <em>baseline model</em> – consequently weights of a baseline model will never be explicitly mentioned. When scenario weights are not identically equal to 1, such that some scenarios are more weighted than others, we say that we have a <em>stressed model</em>.</p>
<p>The scenario weights make the joint distribution of model components under the stressed model different, compared to the baseline model. For example, under the baseline model, the expected value of <span class="math inline">\(X_1\)</span> and the cumulative distribution function of <span class="math inline">\(X_1\)</span>, at threshold <span class="math inline">\(t\)</span>, are respectively given by:</p>
<p><span class="math display">\[
E(X_1)=\frac 1  n \sum_{i=1}^nx_{1i},\quad F_{X_1}(t)= P(X_1\leq t)=\frac 1 n \sum_{i=1}^n \mathbf 1 _{x_{1i}\leq t},
\]</span></p>
<p>where <span class="math inline">\(\mathbf 1 _{x_{1i}\leq t}=1\)</span> if <span class="math inline">\(x_{1i}\leq t\)</span> and <span class="math inline">\(0\)</span> otherwise. For a stressed model with scenario weights <span class="math inline">\(W\)</span>, the expected value <span class="math inline">\(E^W\)</span> and cumulative distribution function <span class="math inline">\(F^W\)</span> become:</p>
<p><span class="math display">\[
E^W(X_1)=\frac 1  n \sum_{i=1}^n w_i x_{1i},\quad F_{X_1}^W(t)=P^W(X_1\leq t)=\frac 1 n \sum_{i=1}^n w_i \mathbf 1 _{x_{1i}\leq t}.
\]</span></p>
<p>Similar expressions can be derived for more involved quantities, such as higher (joint) moments and quantiles.</p>
<p>The logic of stressing a model with <strong>SWIM</strong> then proceeds as follows. An analyst or modeller is supplied with a baseline model, in the form of a matrix of equiprobable simulated scenarios of model components. The modeller wants to investigate the impact of a change in the distribution of, say, <span class="math inline">\(X_1\)</span>. To this effect, she chooses a <em>stress</em> on the distribution of <span class="math inline">\(X_i\)</span>, for example requiring that <span class="math inline">\(E^W(X_1)=m\)</span>; we then say that she is <em>stressing</em> <span class="math inline">\(X_1\)</span> and, by extension, the model. Subsequently, <strong>SWIM</strong> calculates the scenario weights such that the stress is fulfilled and the distortion to the baseline model induced by the stress is as small as possible; specifically the Kullback-Leibler divergence (or relative entropy) between the baseline and stressed models is minimised. (See Section <a href="Sec-Scope.html#Rfunctions">3.1</a> for more detail on the different types of possible stresses and the corresponding optimisation problems). Once scenario weights are obtained, they can be used to determine the stressed distribution of any model component or function of model components. For example, for scenario weights <span class="math inline">\(W\)</span> obtained through a stress on <span class="math inline">\(X_1\)</span>, we may calculate</p>
<p><span class="math display">\[
E^W(X_2)=\frac 1  n\sum_{i=1}^n w_i x_{2i},\quad E^W(X_1^2+X_2^2)=\frac 1  n \sum_{i=1}^n w_i \left(x_{1i}^2+ x_{2i}^2 \right).
\]</span></p>
<p>Through this process, the modeller can monitor the impact of the stress on <span class="math inline">\(X_1\)</span> on any other random variable of interest. It is notable that this approach does not necessitate generating new simulations from a stochastic model. As the <strong>SWIM</strong> approach requires a single set of simulated scenarios (the baseline model) it offers a clear computational benefit.</p>
</div>
<div id="an-introductory-example" class="section level2">
<h2><span class="header-section-number">2.2</span> An introductory example</h2>
<p>Here, through an example, we illustrate the basic concepts and usage of <strong>SWIM</strong> for sensitivity analysis. More advanced usage of <strong>SWIM</strong> and options for constructing stresses are demonstrated in Sections <a href="Sec-Scope.html#Sec:Scope">3</a> and <a href="Sec-CreditModel.html#Sec:CreditModel">4</a>.</p>
<p>In sensitivity analysis, one often considers a model with a vector of inputs <span class="math inline">\(\mathbf Z\)</span> and an output <span class="math inline">\(Y=g(Z)\)</span>, for some aggregation function <span class="math inline">\(g\)</span> that maps inputs to the real line. Then the importance of model inputs can be investigated by stressing the distribution of inputs and observing the impact on the output distribution and vice versa <span class="citation">(Pesenti, Millossovich, and Tsanakas <a href="references.html#ref-Pesenti2019" role="doc-biblioref">2019</a>)</span>. (We note that in <strong>SWIM</strong> there is no ex ante assumption about which of the model components <span class="math inline">\((X_1, \dots,X_d)\)</span> should be interpreted as inputs or outputs – these variables could represent any randomly varying quantity in the model. For that reason, we use <span class="math inline">\(X_i\)</span> for variable labels when documenting the <strong>SWIM</strong>’s capabilities, but use alternative notation in illustrations where variables have specific interpretable meanings, as in the current section and in the case study of Section <a href="Sec-CreditModel.html#Sec:CreditModel">4</a>).</p>
<p>Here, we consider a simple portfolio model, with the portfolio loss defined by <span class="math inline">\(Y=Z_1+Z_2+Z_3\)</span>. The random variables <span class="math inline">\(Z_1,Z_2,Z_3\)</span> represent normally distributed losses, with <span class="math inline">\(Z_1\sim N(100,40^2)\)</span>, <span class="math inline">\(Z_2\sim Z_3\sim N(100,20^2)\)</span>. <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span> are correlated, while <span class="math inline">\(Z_3\)</span> is independent of <span class="math inline">\((Z_1,Z_2)\)</span>. Our purpose in this example is to investigate how a stress on the loss <span class="math inline">\(Z_1\)</span> impacts on the overall portfolio loss <span class="math inline">\(Y\)</span>.
First we derive simulated data from the random vector <span class="math inline">\((Z_1,Z_2,Z_3,Y)\)</span>, forming our baseline model.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="Sec-Intro.html#cb2-1"></a><span class="kw">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb2-2"><a href="Sec-Intro.html#cb2-2"></a><span class="co"># number of simulated scenarios</span></span>
<span id="cb2-3"><a href="Sec-Intro.html#cb2-3"></a>n.sim &lt;-<span class="st"> </span><span class="dv">10</span> <span class="op">^</span><span class="st"> </span><span class="dv">5</span></span>
<span id="cb2-4"><a href="Sec-Intro.html#cb2-4"></a><span class="co"># correlation between Z1 and Z2</span></span>
<span id="cb2-5"><a href="Sec-Intro.html#cb2-5"></a>r &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb2-6"><a href="Sec-Intro.html#cb2-6"></a><span class="co"># simulation of Z1  and Z2</span></span>
<span id="cb2-7"><a href="Sec-Intro.html#cb2-7"></a><span class="co"># constructed as a combination of independent standard normals U1, U2</span></span>
<span id="cb2-8"><a href="Sec-Intro.html#cb2-8"></a>U1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n.sim)</span>
<span id="cb2-9"><a href="Sec-Intro.html#cb2-9"></a>U2 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n.sim)</span>
<span id="cb2-10"><a href="Sec-Intro.html#cb2-10"></a>Z1 &lt;-<span class="st"> </span><span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="dv">40</span> <span class="op">*</span><span class="st"> </span>U1</span>
<span id="cb2-11"><a href="Sec-Intro.html#cb2-11"></a>Z2 &lt;-<span class="st"> </span><span class="dv">100</span> <span class="op">+</span><span class="st"> </span><span class="dv">20</span> <span class="op">*</span><span class="st"> </span>(r <span class="op">*</span><span class="st"> </span>U1 <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>r <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>U2)</span>
<span id="cb2-12"><a href="Sec-Intro.html#cb2-12"></a><span class="co"># simulation of Z3</span></span>
<span id="cb2-13"><a href="Sec-Intro.html#cb2-13"></a>Z3 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n.sim, <span class="dv">100</span>, <span class="dv">20</span>)</span>
<span id="cb2-14"><a href="Sec-Intro.html#cb2-14"></a><span class="co"># portfolio loss Y</span></span>
<span id="cb2-15"><a href="Sec-Intro.html#cb2-15"></a>Y &lt;-<span class="st"> </span>Z1 <span class="op">+</span><span class="st"> </span>Z2 <span class="op">+</span><span class="st"> </span>Z3</span>
<span id="cb2-16"><a href="Sec-Intro.html#cb2-16"></a><span class="co"># data of baseline model</span></span>
<span id="cb2-17"><a href="Sec-Intro.html#cb2-17"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(Z1, Z2, Z3, Y)</span></code></pre></div>
<p>Now we introduce a stress to our baseline model. For our first stress, we require that the mean of <span class="math inline">\(Z_1\)</span> is increased from 100 to 110. This is done using the <code>stress</code> function, which generates as output a <strong>SWIM</strong> object, which we call <code>str.mean</code>. This object stores the stressed model, i.e. the realisations of the model components and the scenario weights. In the function call, the argument <code>k = 1</code> indicates that the stress is applied on the first column of <code>dat</code>, that is, on the realisations of the random variable <span class="math inline">\(Z_1\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="Sec-Intro.html#cb3-1"></a><span class="kw">library</span>(SWIM)</span>
<span id="cb3-2"><a href="Sec-Intro.html#cb3-2"></a>str.mean &lt;-<span class="st"> </span><span class="kw">stress</span>(<span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>, <span class="dt">x =</span> dat, <span class="dt">k =</span> <span class="dv">1</span>, <span class="dt">new_means =</span> <span class="dv">110</span>)</span></code></pre></div>
<pre><code>##   cols required_moment achieved_moment abs_error rel_error
## 1    1             110             110  -8.8e-10    -8e-12</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="Sec-Intro.html#cb5-1"></a><span class="kw">summary</span>(str.mean, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $base
##                   Z1       Z2       Z3        Y
## mean         1.0e+02  99.9404  99.9843 299.9811
## sd           4.0e+01  19.9970  19.9819  56.6389
## skewness    -6.1e-04   0.0012  -0.0025  -0.0023
## ex kurtosis -1.1e-02  -0.0090  -0.0126  -0.0094
## 1st Qu.      7.3e+01  86.4745  86.4816 261.6121
## Median       1.0e+02  99.9866 100.0091 300.0548
## 3rd Qu.      1.3e+02 113.3957 113.4934 338.2670
## 
## $`stress 1`
##                   Z1       Z2       Z3        Y
## mean        110.0000 102.4437  99.9828 312.4265
## sd           40.0333  19.9954  19.9762  56.6173
## skewness     -0.0024  -0.0015  -0.0049  -0.0037
## ex kurtosis  -0.0050  -0.0032  -0.0155  -0.0012
## 1st Qu.      82.9984  88.9771  86.4815 274.2200
## Median      110.0759 102.4810  99.9954 312.5039
## 3rd Qu.     136.9310 115.8744 113.5019 350.6120</code></pre>
<p>The <code>summary</code> function, applied to the <strong>SWIM</strong> object <code>str.mean</code>, shows how the distributional characteristics of all random variables change from the baseline to the stressed model. In particular, we see that the mean of <span class="math inline">\(Z_1\)</span> changes to its required value, while the mean of <span class="math inline">\(Y\)</span> also increases. Furthermore there is a small impact on <span class="math inline">\(Z_2\)</span>, due to its positive correlation to <span class="math inline">\(Z_1\)</span>.</p>
<p>Beyond considering the standard statistics evaluated via the <code>summary</code> function, stressed probability distributions can be plotted. In Figure <a href="Sec-Intro.html#fig:example1-cdfs-mean">2.1</a> we show the impact of the stress on the cumulative distribution functions (cdf) of <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Y\)</span>. It is seen how the stressed cdfs are lower than the original (baseline) ones. Loosely speaking, this demonstrates that the stress has increased (in a stochastic sense) both random variables <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Y\)</span>. While the stress was on <span class="math inline">\(Z_1\)</span>, the impact on the distribution of the portfolio <span class="math inline">\(Y\)</span> is clearly visible.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="Sec-Intro.html#cb7-1"></a><span class="co"># refer to variable of interest by name...</span></span>
<span id="cb7-2"><a href="Sec-Intro.html#cb7-2"></a><span class="kw">plot_cdf</span>(str.mean, <span class="dt">xCol =</span> <span class="st">&quot;Z1&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb7-3"><a href="Sec-Intro.html#cb7-3"></a><span class="co"># ... or column number</span></span>
<span id="cb7-4"><a href="Sec-Intro.html#cb7-4"></a><span class="kw">plot_cdf</span>(str.mean, <span class="dt">xCol =</span> <span class="dv">4</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:example1-cdfs-mean"></span>
<img src="bookdown-SWIM_files/figure-html/example1-cdfs-mean-1.png" alt="Baseline and stressed empirical distribution functions of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the mean of $Z_1$." width="50%" /><img src="bookdown-SWIM_files/figure-html/example1-cdfs-mean-2.png" alt="Baseline and stressed empirical distribution functions of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the mean of $Z_1$." width="50%" />
<p class="caption">
Figure 2.1: Baseline and stressed empirical distribution functions of model components <span class="math inline">\(Z_1\)</span> (left) and <span class="math inline">\(Y\)</span> (right), subject to a stress on the mean of <span class="math inline">\(Z_1\)</span>.
</p>
</div>
<p>The scenario weights, given their central role, can be extracted from a <strong>SWIM</strong> object. In Figure <a href="Sec-Intro.html#fig:example1-weights-mean">2.2</a>, the scenario weights from <code>str.mean</code> are plotted against realisations from <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Y\)</span> respectively. It is seen how the weights are increasing in the realisations from <span class="math inline">\(Z_1\)</span>. This is a consequence of the weights’ derivation via a stress on the model component <span class="math inline">\(Z_1\)</span>. The increasingness shows that those scenarios for which <span class="math inline">\(Z_1\)</span> is largest are assigned a higher weight. The relation between scenario weights and <span class="math inline">\(Y\)</span> is still increasing (reflecting that high outcomes of <span class="math inline">\(Y\)</span> tend to receive higher weights), but no longer deterministic (showing that <span class="math inline">\(Y\)</span> is not completely driven by changes in <span class="math inline">\(Z_1\)</span>). Figure <a href="Sec-Intro.html#fig:example-weights-z1-z2">2.3</a> displays the scenario weights as a function of the input variable <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span>. The different colours of the scenario weights indicate their relative sizes. We observe that the scenario weights are increasing jointly in <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Z_2\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="Sec-Intro.html#cb8-1"></a><span class="co"># parameter n specifies the number of scenario weights plotted</span></span>
<span id="cb8-2"><a href="Sec-Intro.html#cb8-2"></a><span class="kw">plot_weights</span>(str.mean, <span class="dt">xCol =</span> <span class="st">&quot;Z1&quot;</span>, <span class="dt">n =</span> <span class="dv">1000</span>)</span>
<span id="cb8-3"><a href="Sec-Intro.html#cb8-3"></a><span class="co"># specifying the limits of the x-axis</span></span>
<span id="cb8-4"><a href="Sec-Intro.html#cb8-4"></a><span class="kw">plot_weights</span>(str.mean, <span class="dt">xCol =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">x_limits =</span> <span class="kw">c</span>(<span class="dv">90</span>, <span class="dv">550</span>), <span class="dt">n =</span> <span class="dv">1000</span>)</span></code></pre></div>
<div class="figure"><span id="fig:example1-weights-mean"></span>
<img src="bookdown-SWIM_files/figure-html/example1-weights-mean-1.png" alt="Scenario weights against observations of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the mean of $Z_1$." width="50%" /><img src="bookdown-SWIM_files/figure-html/example1-weights-mean-2.png" alt="Scenario weights against observations of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the mean of $Z_1$." width="50%" />
<p class="caption">
Figure 2.2: Scenario weights against observations of model components <span class="math inline">\(Z_1\)</span> (left) and <span class="math inline">\(Y\)</span> (right), subject to a stress on the mean of <span class="math inline">\(Z_1\)</span>.
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:example-weights-z1-z2"></span>
<img src="bookdown-SWIM_files/figure-html/example-weights-z1-z2-1.png" alt="Scenario weights for observations of model components $Z_1$ $Z_2$ subject to a stress on the mean of $Z_1$." width="50%" />
<p class="caption">
Figure 2.3: Scenario weights for observations of model components <span class="math inline">\(Z_1\)</span> <span class="math inline">\(Z_2\)</span> subject to a stress on the mean of <span class="math inline">\(Z_1\)</span>.
</p>
</div>
<p>The stress to the mean of <span class="math inline">\(Z_1\)</span> did not impact the volatility of either <span class="math inline">\(Z_1\)</span> or <span class="math inline">\(Y\)</span>, as can be seen by the practically unchanged standard deviations in the output of <code>summary(str.mean)</code>. Thus, we introduce an alternative stress that keeps the mean of <span class="math inline">\(Z_1\)</span> fixed at 100, but increases its standard deviation from 40 to 50. This new stress is seen to impact the standard deviation of the portfolio loss <span class="math inline">\(Y\)</span>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="Sec-Intro.html#cb9-1"></a>str.sd &lt;-<span class="st"> </span><span class="kw">stress</span>(<span class="dt">type =</span> <span class="st">&quot;mean sd&quot;</span>, <span class="dt">x =</span> dat, <span class="dt">k =</span> <span class="dv">1</span>, <span class="dt">new_means =</span> <span class="dv">100</span>, <span class="dt">new_sd =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>##   cols required_moment achieved_moment abs_error rel_error
## 1    1             100             100  -6.3e-13  -6.3e-15
## 2    1           12500           12500  -1.1e-10  -8.7e-15</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Sec-Intro.html#cb11-1"></a><span class="kw">summary</span>(str.sd, <span class="dt">base =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## $`stress 1`
##                   Z1      Z2       Z3        Y
## mean        100.0000  99.941  99.9782 299.9187
## sd           50.0005  21.349  19.9800  67.9233
## skewness     -0.0027   0.007  -0.0034   0.0049
## ex kurtosis  -0.0556  -0.033  -0.0061  -0.0427
## 1st Qu.      66.0964  85.495  86.4822 253.7496
## Median      100.1290  99.974 100.0455 299.9766
## 3rd Qu.     133.7733 114.301 113.4701 345.9159</code></pre>
<p>Furthermore, in Figure <a href="Sec-Intro.html#fig:example1-cdfs-sd">2.4</a>, we compare the baseline and stressed cdfs of <span class="math inline">\(Z_1\)</span> and <span class="math inline">\(Y\)</span>, under the new stress on <span class="math inline">\(Z_1\)</span>. The crossing of probability distributions reflects the increase in volatility.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="Sec-Intro.html#cb13-1"></a><span class="kw">plot_cdf</span>(str.sd, <span class="dt">xCol =</span> <span class="st">&quot;Z1&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-2"><a href="Sec-Intro.html#cb13-2"></a><span class="kw">plot_cdf</span>(str.sd, <span class="dt">xCol =</span> <span class="dv">4</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure"><span id="fig:example1-cdfs-sd"></span>
<img src="bookdown-SWIM_files/figure-html/example1-cdfs-sd-1.png" alt="Baseline and stressed empirical distribution functions of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the standard deviation of $Z_1$." width="50%" /><img src="bookdown-SWIM_files/figure-html/example1-cdfs-sd-2.png" alt="Baseline and stressed empirical distribution functions of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the standard deviation of $Z_1$." width="50%" />
<p class="caption">
Figure 2.4: Baseline and stressed empirical distribution functions of model components <span class="math inline">\(Z_1\)</span> (left) and <span class="math inline">\(Y\)</span> (right), subject to a stress on the standard deviation of <span class="math inline">\(Z_1\)</span>.
</p>
</div>
<p>The different way in which a stress on the standard deviation of <span class="math inline">\(Z_1\)</span> impacts on the model, compared to a stress on the mean, is reflected by the scenario weights. Figure <a href="Sec-Intro.html#fig:example1-weights-sd">2.5</a> shows the pattern of the scenario weights and how, when stressing standard deviations, higher weight is placed on scenarios where <span class="math inline">\(Z_1\)</span> is extreme, either much lower or much higher than its mean of 100.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="Sec-Intro.html#cb14-1"></a><span class="kw">plot_weights</span>(str.sd, <span class="dt">xCol =</span> <span class="st">&quot;Z1&quot;</span>, <span class="dt">n =</span> <span class="dv">2000</span>)</span>
<span id="cb14-2"><a href="Sec-Intro.html#cb14-2"></a><span class="kw">plot_weights</span>(str.sd, <span class="dt">xCol =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">n =</span> <span class="dv">2000</span>)</span></code></pre></div>
<div class="figure"><span id="fig:example1-weights-sd"></span>
<img src="bookdown-SWIM_files/figure-html/example1-weights-sd-1.png" alt="Scenario weights against observations of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the standard deviation of $Z_1$." width="50%" /><img src="bookdown-SWIM_files/figure-html/example1-weights-sd-2.png" alt="Scenario weights against observations of model components  $Z_1$ (left) and $Y$ (right), subject to a stress on the standard deviation of $Z_1$." width="50%" />
<p class="caption">
Figure 2.5: Scenario weights against observations of model components <span class="math inline">\(Z_1\)</span> (left) and <span class="math inline">\(Y\)</span> (right), subject to a stress on the standard deviation of <span class="math inline">\(Z_1\)</span>.
</p>
</div>
<p>Finally we ought to note that not all stresses that one may wish to apply are feasible. Assume for example that we want to increase the mean of <span class="math inline">\(Z_1\)</span> from 100 to 300, which exceeds the maximum realisation of <span class="math inline">\(Z_1\)</span> in the baseline model. Then, clearly, no set of scenario weights can be found that produce a stress that yields the required mean for <span class="math inline">\(Z_1\)</span>; consequently an error message is produced.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="Sec-Intro.html#cb15-1"></a><span class="kw">stress</span>(<span class="dt">type =</span> <span class="st">&quot;mean&quot;</span>, <span class="dt">x =</span> dat, <span class="dt">k =</span> <span class="dv">1</span>, <span class="dt">new_means =</span> <span class="dv">300</span>)</span></code></pre></div>
<pre><code>## Error in stress_moment(x = x, f = means, k = as.list(k), m = new_means, :
Values in m must be in the range of f(x)</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="Sec-Intro.html#cb17-1"></a><span class="kw">max</span>(Z1)</span></code></pre></div>
<pre><code>## [1] 273</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Sec-Scope.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-SWIM.pdf"],
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
},
"search": true,
"css": "toc.css"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
