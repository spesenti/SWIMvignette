<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Case study | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis</title>
  <meta name="description" content="4 Case study | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Case study | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="spesenti/SWIMvignette" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Case study | Scenario Weights for Importance Measurement (SWIM) – an R package for sensitivity analysis" />
  
  
  

<meta name="author" content="Silvana M. Pesenti 2, Alberto Bettini3, Pietro Millossovich4,5, Andreas Tsanakas5" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Sec-Scope.html"/>
<link rel="next" href="conclusion-and-future-work.html"/>
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="assets/header-attrs-2.1/header-attrs.js"></script>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#background-and-contribution"><i class="fa fa-check"></i><b>1.1</b> Background and contribution</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#installation"><i class="fa fa-check"></i><b>1.2</b> Installation</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#structure-of-the-paper"><i class="fa fa-check"></i><b>1.3</b> Structure of the paper</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Sec-Intro.html"><a href="Sec-Intro.html"><i class="fa fa-check"></i><b>2</b> What is <strong>SWIM</strong>?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Sec-Intro.html"><a href="Sec-Intro.html#sensitivity-testing-and-scenario-weights"><i class="fa fa-check"></i><b>2.1</b> Sensitivity testing and scenario weights</a></li>
<li class="chapter" data-level="2.2" data-path="Sec-Intro.html"><a href="Sec-Intro.html#an-introductory-example"><i class="fa fa-check"></i><b>2.2</b> An introductory example</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Sec-Scope.html"><a href="Sec-Scope.html"><i class="fa fa-check"></i><b>3</b> Scope of the <strong>SWIM</strong> package</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Rfunctions"><i class="fa fa-check"></i><b>3.1</b> Stressing a model</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Rstress"><i class="fa fa-check"></i><b>3.1.1</b> The <code>stress</code> function and the <strong>SWIM</strong> object</a></li>
<li class="chapter" data-level="3.1.2" data-path="Sec-Scope.html"><a href="Sec-Scope.html#stressing-disjoint-probability-intervals"><i class="fa fa-check"></i><b>3.1.2</b> Stressing disjoint probability intervals</a></li>
<li class="chapter" data-level="3.1.3" data-path="Sec-Scope.html"><a href="Sec-Scope.html#stressing-moments"><i class="fa fa-check"></i><b>3.1.3</b> Stressing moments</a></li>
<li class="chapter" data-level="3.1.4" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Sec:RiskMeasures"><i class="fa fa-check"></i><b>3.1.4</b> Stressing risk measures</a></li>
<li class="chapter" data-level="3.1.5" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Sec:User"><i class="fa fa-check"></i><b>3.1.5</b> User defined scenario weights</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="Sec-Scope.html"><a href="Sec-Scope.html#Sec:analysis"><i class="fa fa-check"></i><b>3.2</b> Analysis of stressed models</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="Sec-Scope.html"><a href="Sec-Scope.html#distributional-comparison"><i class="fa fa-check"></i><b>3.2.1</b> Distributional comparison</a></li>
<li class="chapter" data-level="3.2.2" data-path="Sec-Scope.html"><a href="Sec-Scope.html#sensitivity-measures"><i class="fa fa-check"></i><b>3.2.2</b> Sensitivity measures</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html"><i class="fa fa-check"></i><b>4</b> Case study</a>
<ul>
<li class="chapter" data-level="4.1" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#a-credit-risk-portfolio"><i class="fa fa-check"></i><b>4.1</b> A credit risk portfolio</a></li>
<li class="chapter" data-level="4.2" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#stressing-the-portfolio-loss"><i class="fa fa-check"></i><b>4.2</b> Stressing the portfolio loss</a></li>
<li class="chapter" data-level="4.3" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#analysing-stressed-models"><i class="fa fa-check"></i><b>4.3</b> Analysing stressed models</a></li>
<li class="chapter" data-level="4.4" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#visualising-stressed-distributions"><i class="fa fa-check"></i><b>4.4</b> Visualising stressed distributions</a></li>
<li class="chapter" data-level="4.5" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#sensitivity-measures-1"><i class="fa fa-check"></i><b>4.5</b> Sensitivity measures</a></li>
<li class="chapter" data-level="4.6" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#constructing-more-advanced-stresses"><i class="fa fa-check"></i><b>4.6</b> Constructing more advanced stresses</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#sensitivity-of-default-probabilities"><i class="fa fa-check"></i><b>4.6.1</b> Sensitivity of default probabilities</a></li>
<li class="chapter" data-level="4.6.2" data-path="Sec-CreditModel.html"><a href="Sec-CreditModel.html#stressing-tails-of-subportfolios"><i class="fa fa-check"></i><b>4.6.2</b> Stressing tails of subportfolios</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="conclusion-and-future-work.html"><a href="conclusion-and-future-work.html"><i class="fa fa-check"></i><b>5</b> Conclusion and future work</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="AppendixCM.html"><a href="AppendixCM.html"><i class="fa fa-check"></i><b>A</b> Appendix Credit Model</a>
<ul>
<li class="chapter" data-level="A.1" data-path="AppendixCM.html"><a href="AppendixCM.html#credit-model-assumptions"><i class="fa fa-check"></i><b>A.1</b> Credit Model assumptions</a></li>
<li class="chapter" data-level="A.2" data-path="AppendixCM.html"><a href="AppendixCM.html#code-for-generating-the-data"><i class="fa fa-check"></i><b>A.2</b> Code for generating the data</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Scenario Weights for Importance Measurement (<strong>SWIM</strong>) – an <strong>R</strong> package for sensitivity analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Sec:CreditModel" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Case study</h1>
<div id="a-credit-risk-portfolio" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> A credit risk portfolio</h2>
<p>The credit model in this section is a conditionally binomial loan portfolio model including systematic and specific portfolio risk. We refer to the Appendix <a href="AppendixCM.html#AppendixCM">A</a> for details about the model and the generation of the simulated data. A key variable of interest is the total aggregate portfolio loss <span class="math inline">\(L = L_1 + L_2 + L_3\)</span>, where <span class="math inline">\(L_1, L_2, L_3\)</span> are homogeneous subportfolios on a comparable scale (say, thousands of $). The dataset contains 100,000 simulations of the portfolio <span class="math inline">\(L\)</span>, the subportfolios <span class="math inline">\(L_1, L_2, L_3\)</span> as well as the random default probabilities within each subportfolio, <span class="math inline">\(H_1, H_2, H_3\)</span>. These default probabilities represent the systematic risk <em>within</em> each subportfolio, while their dependence structure represents a systematic risk effect <em>between</em> the subportfolios. The simulated data of the credit risk portfolio are included in the <strong>SWIM</strong> package and can be accessed via <code>data("credit_data")</code>. A snippet of the dataset looks as follows:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="Sec-CreditModel.html#cb15-1"></a><span class="kw">data</span>(<span class="st">&quot;credit_data&quot;</span>)</span>
<span id="cb15-2"><a href="Sec-CreditModel.html#cb15-2"></a><span class="kw">head</span>(credit_data)</span></code></pre></div>
<pre><code>##         L L1    L2  L3       H1      H2     H3
## [1,]  692  0 346.9 345 1.24e-04 0.00780 0.0294
## [2,] 1006 60 515.6 430 1.16e-03 0.01085 0.0316
## [3,] 1661  0 806.2 855 5.24e-04 0.01490 0.0662
## [4,] 1708  0 937.5 770 2.58e-04 0.02063 0.0646
## [5,]  807  0  46.9 760 8.06e-05 0.00128 0.0632
## [6,] 1159 20 393.8 745 2.73e-04 0.00934 0.0721</code></pre>
</div>
<div id="stressing-the-portfolio-loss" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Stressing the portfolio loss</h2>
<p>In this section, following a reverse sensitivity approach, we study the effects that stresses on (the tail of) the aggregate portfolio loss <span class="math inline">\(L\)</span> have on the three subportfolios; thus assessing their comparative importance. First, we impose a <span class="math inline">\(20\%\)</span> increase on the VaR at level <span class="math inline">\(90\%\)</span> of the portfolio loss.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="Sec-CreditModel.html#cb17-1"></a>stress.credit &lt;-<span class="st"> </span><span class="kw">stress</span>(<span class="dt">type =</span> <span class="st">&quot;VaR&quot;</span>, <span class="dt">x =</span> credit_data, <span class="dt">k =</span> <span class="st">&quot;L&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>, </span>
<span id="cb17-2"><a href="Sec-CreditModel.html#cb17-2"></a>    <span class="dt">q_ratio =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<pre><code>## Stressed VaR specified was 2174.25 , stressed VaR achieved is 2173.75</code></pre>
<p>The <span class="math inline">\(20\%\)</span> increase was specified by setting the <code>q_ratio</code> argument to <span class="math inline">\(1.2\)</span> – alternatively the argument <code>q</code> can be set to the actual value of the stressed VaR.</p>
<p>Using the function <code>VaR_stressed</code>, we can quantify how tail quantiles of the aggregate portfolio loss change, when moving from the baseline to the stressed model. We observe that the increase in the VaR of the portfolio loss changes more broadly its tail quantiles; thus the stress on VaR also induces an increase in ES. The implemented functions <code>VaR_stressed</code> and <code>ES_stressed</code> calculate respectively VaR and ES; the argument <code>alpha</code> specifies the levels of VaR and ES, respectively, while the stressed model under which the risk measures are calculated can be chosen using <code>wCol</code> (by default equal to 1).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="Sec-CreditModel.html#cb19-1"></a><span class="kw">VaR_stressed</span>(<span class="dt">object =</span> stress.credit, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>), </span>
<span id="cb19-2"><a href="Sec-CreditModel.html#cb19-2"></a>    <span class="dt">xCol =</span> <span class="st">&quot;L&quot;</span>, <span class="dt">wCol =</span> <span class="dv">1</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        L base L
## 75% 1506   1399
## 90% 2174   1812
## 95% 2426   2085
## 99% 2997   2671</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="Sec-CreditModel.html#cb21-1"></a><span class="kw">ES_stressed</span>(<span class="dt">object =</span> stress.credit, <span class="dt">alpha =</span> <span class="fl">0.9</span>, <span class="dt">xCol =</span> <span class="st">&quot;L&quot;</span>, <span class="dt">wCol =</span> <span class="dv">1</span>, </span>
<span id="cb21-2"><a href="Sec-CreditModel.html#cb21-2"></a>    <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        L base L
## 90% 2535   2191</code></pre>
<p>As a second stress, we consider, additionally to the <span class="math inline">\(20\%\)</span> increase in the <span class="math inline">\(\text{VaR}_{0.9}\)</span>, an increase in <span class="math inline">\(\text{ES}_{0.9}\)</span> of the portfolio loss <span class="math inline">\(L\)</span>. When stressing VaR and ES together via <code>stress_VaR_ES</code>, both VaR and ES need to be stressed at the same level, here <code>alpha = 0.9</code>. We observe that when stressing the VaR alone, ES increases to 2535. For the second stress we want a greater impact on ES, thus we require that the stressed ES be equal to 3500. This can be achieved by specifying the argument <code>s</code>, which is the stressed value of ES (rather than <code>s_ratio</code>, the proportional increase).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="Sec-CreditModel.html#cb23-1"></a>stress.credit &lt;-<span class="st"> </span><span class="kw">stress</span>(<span class="dt">type =</span> <span class="st">&quot;VaR ES&quot;</span>, <span class="dt">x =</span> stress.credit, <span class="dt">k =</span> <span class="st">&quot;L&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.9</span>, </span>
<span id="cb23-2"><a href="Sec-CreditModel.html#cb23-2"></a>    <span class="dt">q_ratio =</span> <span class="fl">1.2</span>, <span class="dt">s =</span> <span class="dv">3500</span>)</span></code></pre></div>
<pre><code>## Stressed VaR specified was 2174.25 , stressed VaR achieved is 2173.75</code></pre>
<p>When applying the <code>stress</code> function or one of its alternative versions to a <strong>SWIM</strong> object rather than to a data frame (via <code>x = stress.credit</code> in the example above), the result will be a new <strong>SWIM</strong> object with the new stress “appended” to existing stresses. This is convenient when large datasets are involved, as the <code>stress</code> function returns an object containing the original simulated data and the scenario weights. Note however, that this only works if the underlying data are exactly the same.</p>
</div>
<div id="analysing-stressed-models" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Analysing stressed models</h2>
<p>The <code>summary</code> function provides a statistical summary of the stressed models. Choosing <code>base = TRUE</code> compares the stressed models with the the baseline model.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="Sec-CreditModel.html#cb25-1"></a><span class="kw">summary</span>(stress.credit, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $base
##                    L    L1     L2      L3       H1      H2     H3
## mean        1102.914 19.96 454.04 628.912 0.000401 0.00968 0.0503
## sd           526.538 28.19 310.99 319.715 0.000400 0.00649 0.0252
## skewness       0.942  2.10   1.31   0.945 1.969539 1.30834 0.9501
## ex kurtosis    1.326  6.21   2.52   1.256 5.615908 2.49792 1.2708
## 1st Qu.      718.750  0.00 225.00 395.000 0.000115 0.00490 0.0318
## Median      1020.625  0.00 384.38 580.000 0.000279 0.00829 0.0464
## 3rd Qu.     1398.750 20.00 609.38 810.000 0.000555 0.01296 0.0643
## 
## $`stress 1`
##                   L    L1     L2     L3       H1      H2     H3
## mean        1193.39 20.83 501.10 671.46 0.000417 0.01066 0.0536
## sd           623.48 29.09 363.57 361.21 0.000415 0.00756 0.0285
## skewness       1.01  2.09   1.36   1.02 1.973337 1.35075 1.0283
## ex kurtosis    0.94  6.14   2.23   1.22 5.630153 2.23353 1.2382
## 1st Qu.      739.38  0.00 234.38 405.00 0.000120 0.00512 0.0328
## Median      1065.62 20.00 412.50 605.00 0.000290 0.00878 0.0483
## 3rd Qu.     1505.62 40.00 675.00 865.00 0.000578 0.01422 0.0688
## 
## $`stress 2`
##                   L    L1     L2     L3       H1      H2     H3
## mean        1289.90 21.70 558.27 709.93 0.000437 0.01180 0.0566
## sd           875.90 30.57 507.78 447.30 0.000448 0.01045 0.0351
## skewness       1.90  2.17   2.10   1.57 2.090425 2.10128 1.5384
## ex kurtosis    3.67  6.74   4.79   2.80 6.203429 4.97000 2.6142
## 1st Qu.      739.38  0.00 234.38 405.00 0.000123 0.00512 0.0328
## Median      1065.62 20.00 412.50 605.00 0.000297 0.00879 0.0484
## 3rd Qu.     1505.62 40.00 675.00 875.00 0.000594 0.01439 0.0697</code></pre>
<p>Note that <code>stress 1</code> is the <code>summary</code> output corresponding to the <span class="math inline">\(20\%\)</span> increase in the VaR, while <code>stress 2</code> corresponds to the stress in both VaR and ES. The information on individual stresses can be recovered through the <code>get_specs</code> function, and the actual scenario weights using <code>get_weights</code>. Since the <strong>SWIM</strong> object <code>stress.credit</code> contains two stresses, the scenario weights that are returned by <code>get_weights</code> form a data frame consisting of two columns, corresponding to <code>stress 1</code> and to <code>stress 2</code>, respectively.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="Sec-CreditModel.html#cb27-1"></a><span class="kw">get_specs</span>(stress.credit)</span></code></pre></div>
<pre><code>##            type k alpha       q    s
## stress 1    VaR L   0.9 2173.75 &lt;NA&gt;
## stress 2 VaR ES L   0.9 2173.75 3500</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="Sec-CreditModel.html#cb29-1"></a><span class="co"># extract weights from SWIM object</span></span>
<span id="cb29-2"><a href="Sec-CreditModel.html#cb29-2"></a>w.credit &lt;-<span class="st"> </span><span class="kw">get_weights</span>(stress.credit)</span>
<span id="cb29-3"><a href="Sec-CreditModel.html#cb29-3"></a><span class="co"># only plot a subset of the sceranio weights </span></span>
<span id="cb29-4"><a href="Sec-CreditModel.html#cb29-4"></a>grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">100000</span>, <span class="dt">by =</span> <span class="dv">50</span>)</span>
<span id="cb29-5"><a href="Sec-CreditModel.html#cb29-5"></a><span class="kw">plot</span>(credit_data[grid, <span class="dv">1</span>], w.credit[grid, <span class="dv">1</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> <span class="st">&quot;L&quot;</span>, </span>
<span id="cb29-6"><a href="Sec-CreditModel.html#cb29-6"></a>     <span class="dt">ylab =</span> <span class="st">&quot;scenario weights&quot;</span>)</span>
<span id="cb29-7"><a href="Sec-CreditModel.html#cb29-7"></a><span class="kw">plot</span>(credit_data[grid, <span class="dv">1</span>], w.credit[grid, <span class="dv">2</span>], <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> <span class="st">&quot;L&quot;</span>, </span>
<span id="cb29-8"><a href="Sec-CreditModel.html#cb29-8"></a>     <span class="dt">ylab =</span> <span class="st">&quot;scenario weights&quot;</span>)</span></code></pre></div>
<div class="figure"><span id="fig:credit-weights"></span>
<img src="bookdown-SWIM_files/figure-html/credit-weights-1.png" alt="Scenario weights against the portfolio loss $L$ for stressing VaR (left) and stressing both VaR and ES (right)." width="50%" /><img src="bookdown-SWIM_files/figure-html/credit-weights-2.png" alt="Scenario weights against the portfolio loss $L$ for stressing VaR (left) and stressing both VaR and ES (right)." width="50%" />
<p class="caption">
Figure 4.1: Scenario weights against the portfolio loss <span class="math inline">\(L\)</span> for stressing VaR (left) and stressing both VaR and ES (right).
</p>
</div>
<p>It is seen in Figure <a href="Sec-CreditModel.html#fig:credit-weights">4.1</a> that the weights generated to stress VaR, and VaR and ES together, follow different patterns to the weights used to stress means and standard deviations, as shown in Section <a href="Sec-Intro.html#Sec:Intro">2</a>. Recall that <strong>SWIM</strong> calculates the scenario weights such that under the stressed model the given constraints are fulfilled. Thus, an increase in the VaR and/or ES of the portfolio loss <span class="math inline">\(L\)</span> results in large positive realisations of <span class="math inline">\(L\)</span> being assigned higher weight. On the other hand, when the standard deviation is stressed, scenario weights are calculated that inflate the probabilities of both large positive and negative values.</p>
</div>
<div id="visualising-stressed-distributions" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Visualising stressed distributions</h2>
<p>The change in the distributions of the portfolio and subportfolio losses, when moving from the baseline to the stressed models, can be visualised through the functions <code>plot_hist</code> and <code>plot_cdf</code>. The following figure displays the histogram of the aggregate portfolio loss under the baseline and the two stressed models. It is seen how stressing VaR and ES has a higher impact on the right tail of <span class="math inline">\(L\)</span>, compared to stressing VaR only. This is consistent with the tail-sensitive nature of the Expected Shortfall risk measure <span class="citation">(McNeil, Frey, and Embrechts <a href="references.html#ref-Mcneil2015B" role="doc-biblioref">2015</a>)</span>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="Sec-CreditModel.html#cb30-1"></a><span class="kw">plot_hist</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="st">&quot;L&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:CM-histL"></span>
<img src="bookdown-SWIM_files/figure-html/CM-histL-1.png" alt="Histogram of the portfolio loss $L$ under the baseline and the two stressed models." width="80%" />
<p class="caption">
Figure 4.2: Histogram of the portfolio loss <span class="math inline">\(L\)</span> under the baseline and the two stressed models.
</p>
</div>
<p>The arguments <code>xCol</code> and <code>wCol</code> (with default to plot all stresses) define the columns of the data and the columns of the scenario weights, respectively, that are used for plotting. Next, we analyse the impact that stressing the aggregate loss <span class="math inline">\(L\)</span> has on the subportfolios <span class="math inline">\(L_1,~ L_2~L_3\)</span>. Again, we use the function <code>plot_hist</code> and <code>plot_cdf</code> for visual comparison, but this time placing the distribution plots and histograms of subportfolio losses along each other via the function <code>ggarrange</code> (from the package <strong>ggpubr</strong>). The plots obtained from <code>plot_hist</code> and <code>plot_cdf</code> can be further personalised when specifying the argument <code>displ = FALSE</code>, as then the graphical functions <code>plot_hist</code> and <code>plot_cdf</code> return data frames compatible with the package <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="Sec-CreditModel.html#cb31-1"></a>pL1.cdf &lt;-<span class="st"> </span><span class="kw">plot_cdf</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">2</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-2"><a href="Sec-CreditModel.html#cb31-2"></a>pL2.cdf &lt;-<span class="st"> </span><span class="kw">plot_cdf</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">3</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-3"><a href="Sec-CreditModel.html#cb31-3"></a>pL3.cdf &lt;-<span class="st"> </span><span class="kw">plot_cdf</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">4</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-4"><a href="Sec-CreditModel.html#cb31-4"></a></span>
<span id="cb31-5"><a href="Sec-CreditModel.html#cb31-5"></a>pL1.hist &lt;-<span class="st"> </span><span class="kw">plot_hist</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">2</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-6"><a href="Sec-CreditModel.html#cb31-6"></a>pL2.hist &lt;-<span class="st"> </span><span class="kw">plot_hist</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">3</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-7"><a href="Sec-CreditModel.html#cb31-7"></a>pL3.hist &lt;-<span class="st"> </span><span class="kw">plot_hist</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">4</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-8"><a href="Sec-CreditModel.html#cb31-8"></a></span>
<span id="cb31-9"><a href="Sec-CreditModel.html#cb31-9"></a><span class="kw">ggarrange</span>(pL1.cdf, pL1.hist, pL2.cdf, pL2.hist, pL3.cdf, pL3.hist, <span class="dt">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb31-10"><a href="Sec-CreditModel.html#cb31-10"></a>    <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">common.legend =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:CM-plot1"></span>
<img src="bookdown-SWIM_files/figure-html/CM-plot1-1.png" alt="Distribution functions and histograms of the subportfolios $L_1, L_2, L_3$ for the stresses on the VaR (stress 1) and on both the VaR and ES (stress 2) of the portfolio loss $L$." width="100%" />
<p class="caption">
Figure 4.3: Distribution functions and histograms of the subportfolios <span class="math inline">\(L_1, L_2, L_3\)</span> for the stresses on the VaR (stress 1) and on both the VaR and ES (stress 2) of the portfolio loss <span class="math inline">\(L\)</span>.
</p>
</div>
<p>It is seen from both the distribution plots and the histograms in Figures <a href="Sec-CreditModel.html#fig:CM-histL">4.2</a> and <a href="Sec-CreditModel.html#fig:CM-plot1">4.3</a> that the stresses have no substantial impact on <span class="math inline">\(L_1\)</span>, while <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> are more affected, indicating a higher sensitivity. The higher impact on the tails of stress 2 (on both VaR and ES) is also visible. Sensitivity measures quantifying these effects are introduced in the following subsection.</p>
</div>
<div id="sensitivity-measures-1" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Sensitivity measures</h2>
<p>The impact of the stressed models on the model components can be quantified through sensitivity measures. The function <code>sensitivity</code> includes the <em>Kolmogorov</em> distance, the <em>Wasserstein</em> distance, and the sensitivity measure <em>Gamma</em>; the choice of measure is by the argument <code>type</code>. We refer to Section <a href="Sec-Scope.html#Sec:analysis">3.2</a> for the definitions of those sensitivity measures. The Kolmogorov distance is useful for comparing different stressed models. It is seen that <code>stress 2</code> produces a more substantial distortion to the baseline distribution of <span class="math inline">\(L\)</span> compared to <code>stress 1</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="Sec-CreditModel.html#cb32-1"></a><span class="kw">sensitivity</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="dv">1</span>, <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;Kolmogorov&quot;</span>)</span></code></pre></div>
<pre><code>##     stress       type      L
## 1 stress 1 Kolmogorov 0.0607
## 2 stress 2 Kolmogorov 0.0748</code></pre>
<p>We now rank the sensitivities of model components by the measure Gamma, for each stressed model. Consistently with what the distribution plots showed, <span class="math inline">\(L_2\)</span> is the most sensitive subportfolio, followed by <span class="math inline">\(L_3\)</span> and <span class="math inline">\(L_1\)</span>. The respective default probabilities <span class="math inline">\(H_1,H_2,H_3\)</span> are similarly ranked.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="Sec-CreditModel.html#cb34-1"></a><span class="kw">sensitivity</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">7</span>), <span class="dt">wCol =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;Gamma&quot;</span>)</span></code></pre></div>
<pre><code>##     stress  type    L1    L2    L3    H1    H2    H3
## 1 stress 1 Gamma 0.150 0.819 0.772 0.196 0.811 0.767
## 2 stress 2 Gamma 0.113 0.734 0.639 0.171 0.708 0.636</code></pre>
<p>Using the <code>sensitivity</code> function we can analyse whether the sensitivity of the joint subportfolio <span class="math inline">\(L_1 + L_3\)</span> exceeds the sensitivity of the (most sensitive) subportfolio <span class="math inline">\(L_2\)</span>. This can be accomplished by specifying, through the argument <code>f</code>, a list of functions applicable to the columns <code>k</code> of the dataset. By setting <code>xCol = NULL</code> only the transformed data is considered. The sensitivity measure of functions of columns of the data is particularly useful when high dimensional models are considered, providing a way to compare the sensitivity of blocks of model components.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="Sec-CreditModel.html#cb36-1"></a><span class="kw">sensitivity</span>(<span class="dt">object =</span> stress.credit, <span class="dt">type =</span> <span class="st">&quot;Gamma&quot;</span>, <span class="dt">f =</span> sum, <span class="dt">k =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), </span>
<span id="cb36-2"><a href="Sec-CreditModel.html#cb36-2"></a>    <span class="dt">wCol =</span> <span class="dv">1</span>, <span class="dt">xCol =</span> <span class="ot">NULL</span>)</span></code></pre></div>
<pre><code>##     stress  type    f1
## 1 stress 1 Gamma 0.783</code></pre>
<p>We observe that the sensitivity of <span class="math inline">\(L_1 + L_3\)</span> is larger than the sensitivity to either <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_3\)</span>, reflecting the positive dependence structure of the credit risk portfolio. Nonetheless, subportfolio <span class="math inline">\(L_2\)</span> has not only the largest sensitivity compared to <span class="math inline">\(L_1\)</span> and <span class="math inline">\(L_3\)</span> but also a higher sensitivity than the combined subportfolios <span class="math inline">\(L_1 + L_3\)</span>.</p>
<p>The <code>importance_rank</code> function, having the same structure as the <code>sensitivity</code> function, returns the ranks of the sensitivity measures. This function is particularly useful when several risk factors are involved.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="Sec-CreditModel.html#cb38-1"></a><span class="kw">importance_rank</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">7</span>), <span class="dt">wCol =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;Gamma&quot;</span>)</span></code></pre></div>
<pre><code>##     stress  type L1 L2 L3 H1 H2 H3
## 1 stress 1 Gamma  6  1  3  5  2  4</code></pre>
</div>
<div id="constructing-more-advanced-stresses" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Constructing more advanced stresses</h2>
<div id="sensitivity-of-default-probabilities" class="section level3" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Sensitivity of default probabilities</h3>
<p>From the preceding analysis, it transpires that the subportfolios <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> are, in that order, most responsible for the stress in the portfolio loss, under both stresses considered. Furthermore, most of the sensitivity seems to be attributable to the systematic risk components <span class="math inline">\(H_2\)</span> and <span class="math inline">\(H_3\)</span>, reflected by their high values of the Gamma measure. To investigate this, we perform another stress, resulting once again in a <span class="math inline">\(20\%\)</span> increase in <span class="math inline">\(\text{VaR}(L)\)</span>, but this time fixing some elements of the distribution of <span class="math inline">\(H_2\)</span>. Specifically, in addition to the <span class="math inline">\(20\%\)</span> increase in <span class="math inline">\(\text{VaR}(L)\)</span>, we fix the mean and the <span class="math inline">\(75\%\)</span> quantile of <span class="math inline">\(H_2\)</span> to the same values as in the baseline model. This set of constraints is implemented via the function <code>stress_moment</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="Sec-CreditModel.html#cb40-1"></a><span class="co"># 90% VaR of L under the baseline model</span></span>
<span id="cb40-2"><a href="Sec-CreditModel.html#cb40-2"></a>VaR.L &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> credit_data[, <span class="st">&quot;L&quot;</span>], <span class="dt">prob =</span> <span class="fl">0.9</span>, <span class="dt">type =</span> <span class="dv">1</span>) </span>
<span id="cb40-3"><a href="Sec-CreditModel.html#cb40-3"></a><span class="co"># 75th quantile of H2 under the baseline model</span></span>
<span id="cb40-4"><a href="Sec-CreditModel.html#cb40-4"></a>q.H2 &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> credit_data[, <span class="st">&quot;H2&quot;</span>], <span class="dt">prob =</span> <span class="fl">0.75</span>, <span class="dt">type =</span> <span class="dv">1</span>) </span>
<span id="cb40-5"><a href="Sec-CreditModel.html#cb40-5"></a><span class="co"># columns to be stressed (L, H2, H2)</span></span>
<span id="cb40-6"><a href="Sec-CreditModel.html#cb40-6"></a>k.stressH2 =<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">6</span>) </span>
<span id="cb40-7"><a href="Sec-CreditModel.html#cb40-7"></a><span class="co"># functions to be applied to columns</span></span>
<span id="cb40-8"><a href="Sec-CreditModel.html#cb40-8"></a>f.stressH2 &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb40-9"><a href="Sec-CreditModel.html#cb40-9"></a>                 <span class="co"># indicator function for L, for stress on VaR</span></span>
<span id="cb40-10"><a href="Sec-CreditModel.html#cb40-10"></a>                 <span class="cf">function</span>(x)<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">&lt;=</span><span class="st"> </span>VaR.L <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>), </span>
<span id="cb40-11"><a href="Sec-CreditModel.html#cb40-11"></a>                 <span class="co"># mean of H2</span></span>
<span id="cb40-12"><a href="Sec-CreditModel.html#cb40-12"></a>                 <span class="cf">function</span>(x)x, </span>
<span id="cb40-13"><a href="Sec-CreditModel.html#cb40-13"></a>                 <span class="co"># indicator function for 75th quaantile of H2</span></span>
<span id="cb40-14"><a href="Sec-CreditModel.html#cb40-14"></a>                 <span class="cf">function</span>(x)<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">&lt;=</span><span class="st"> </span>q.H2)) </span>
<span id="cb40-15"><a href="Sec-CreditModel.html#cb40-15"></a><span class="co"># new values for the 90% VaR of L, mean of H2, 75th quantile of H2</span></span>
<span id="cb40-16"><a href="Sec-CreditModel.html#cb40-16"></a>m.stressH2 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.9</span>, <span class="kw">mean</span>(credit_data[, <span class="st">&quot;H2&quot;</span>]), <span class="fl">0.75</span>) </span>
<span id="cb40-17"><a href="Sec-CreditModel.html#cb40-17"></a>stress.credit &lt;-<span class="st"> </span><span class="kw">stress_moment</span>(<span class="dt">x =</span> stress.credit, <span class="dt">f =</span> f.stressH2, <span class="dt">k =</span> k.stressH2, </span>
<span id="cb40-18"><a href="Sec-CreditModel.html#cb40-18"></a>                               <span class="dt">m =</span> m.stressH2)</span></code></pre></div>
<p>Using the <code>summary</code> function, we verify that the distribution of <span class="math inline">\(H_2\)</span> under the new stress has unchanged mean and 75<sup>th</sup> quantile. Then we compare the sensitivities of the subportfolio losses under all three stresses applied.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="Sec-CreditModel.html#cb41-1"></a><span class="kw">summary</span>(stress.credit, <span class="dt">wCol =</span> <span class="dv">3</span>, <span class="dt">xCol =</span> <span class="dv">6</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## $base
##                  H2
## mean        0.00968
## sd          0.00649
## skewness    1.30834
## ex kurtosis 2.49792
## 1st Qu.     0.00490
## Median      0.00829
## 3rd Qu.     0.01296
## 
## $`stress 3`
##                  H2
## mean        0.00968
## sd          0.00706
## skewness    1.39135
## ex kurtosis 2.26506
## 1st Qu.     0.00453
## Median      0.00786
## 3rd Qu.     0.01296</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="Sec-CreditModel.html#cb43-1"></a><span class="kw">sensitivity</span>(<span class="dt">object =</span> stress.credit, <span class="dt">xCol =</span> <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>), <span class="dt">type =</span> <span class="st">&quot;Gamma&quot;</span>)</span></code></pre></div>
<pre><code>##     stress  type     L1     L2    L3
## 1 stress 1 Gamma 0.1501 0.8195 0.772
## 2 stress 2 Gamma 0.1131 0.7336 0.639
## 3 stress 3 Gamma 0.0102 0.0203 0.366</code></pre>
<p>It is seen that, by fixing part of the distribution of <span class="math inline">\(H_2\)</span>, the importance ranking of the subportfolios changes, with <span class="math inline">\(L_2\)</span> now being significantly less sensitive than <span class="math inline">\(L_3\)</span>. This confirms, in the credit risk model, the dominance of the systematic risk reflected in the randomness of default probabilities.</p>
</div>
<div id="stressing-tails-of-subportfolios" class="section level3" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Stressing tails of subportfolios</h3>
<p>Up to now, we have considered the impact of stressing the aggregate portfolio loss on subportfolios. Now, following a forward sensitivity approach, we consider the opposite situation: stressing the subportfolio losses and monitoring the impact on the aggregate portfolio loss <span class="math inline">\(L\)</span>. First, we impose a stress requiring a simultaneous <span class="math inline">\(20\%\)</span> increase in the 90<sup>th</sup> quantile of the losses in subportfolios <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span>. Note that the function <code>stress_VaR</code> (and <code>stress_VaR_ES</code>) allow to stress the VaR and/or the ES of only one model component. Thus, to induce a stress on the 90<sup>th</sup> quantiles of <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span>, we use the function <code>stress_moments</code> and interpret the quantile constraints as moment constraints, via <span class="math inline">\(E(1_{L_2 \leq \text{VaR}^W(L_2)})\)</span> and <span class="math inline">\(E(1_{L_3 \leq \text{VaR}^W(L_3)})\)</span>, respectively, where <span class="math inline">\(\text{VaR}^W = \text{VaR} \cdot 1.2\)</span> denotes the VaRs in the stressed model.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="Sec-CreditModel.html#cb45-1"></a><span class="co"># VaR of L2 and L3, respectively</span></span>
<span id="cb45-2"><a href="Sec-CreditModel.html#cb45-2"></a>VaR.L2 &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> credit_data[, <span class="st">&quot;L2&quot;</span>], <span class="dt">prob =</span> <span class="fl">0.9</span>, <span class="dt">type =</span> <span class="dv">1</span>) </span>
<span id="cb45-3"><a href="Sec-CreditModel.html#cb45-3"></a>VaR.L3 &lt;-<span class="st"> </span><span class="kw">quantile</span>(<span class="dt">x =</span> credit_data[, <span class="st">&quot;L3&quot;</span>], <span class="dt">prob =</span> <span class="fl">0.9</span>, <span class="dt">type =</span> <span class="dv">1</span>) </span>
<span id="cb45-4"><a href="Sec-CreditModel.html#cb45-4"></a><span class="co">#stressing VaR of L2 and L3</span></span>
<span id="cb45-5"><a href="Sec-CreditModel.html#cb45-5"></a>f.stress &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="cf">function</span>(x)<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">&lt;=</span><span class="st"> </span>VaR.L2 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>), </span>
<span id="cb45-6"><a href="Sec-CreditModel.html#cb45-6"></a>                 <span class="cf">function</span>(x)<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(x <span class="op">&lt;=</span><span class="st"> </span>VaR.L3 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>)) </span>
<span id="cb45-7"><a href="Sec-CreditModel.html#cb45-7"></a>stress.credit.L2L3 &lt;-<span class="st"> </span><span class="kw">stress_moment</span>(<span class="dt">x =</span> credit_data, <span class="dt">f =</span> f.stress, <span class="dt">k =</span> <span class="kw">list</span>(<span class="dv">3</span>, <span class="dv">4</span>), </span>
<span id="cb45-8"><a href="Sec-CreditModel.html#cb45-8"></a>                                    <span class="dt">m =</span> <span class="kw">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>))</span>
<span id="cb45-9"><a href="Sec-CreditModel.html#cb45-9"></a><span class="co">#impact on portfolio tail</span></span>
<span id="cb45-10"><a href="Sec-CreditModel.html#cb45-10"></a><span class="kw">VaR_stressed</span>(stress.credit.L2L3, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>), <span class="dt">xCol =</span> <span class="st">&quot;L&quot;</span>, </span>
<span id="cb45-11"><a href="Sec-CreditModel.html#cb45-11"></a>             <span class="dt">base =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##        L base L
## 75% 1556   1399
## 90% 2086   1812
## 95% 2423   2085
## 99% 3072   2671</code></pre>
<p>It is seen how the stressing of subportfolios <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> has a substantial impact on the portfolio loss. Given the importance of dependence for the distribution of the aggregate loss of the portfolio, we strengthen this stress further, by additionally requiring that the frequency of joint high losses from <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> is increased. Specifically, we require the joint exceedance probability to be <span class="math inline">\(P^W(L_2 &gt; VaR^W(L_2),~ L_3 &gt; VaR^W(L_3)) = 0.06\)</span>, which is almost doubling the corresponding probability in the last stressed model, which was equal to 0.0308.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="Sec-CreditModel.html#cb47-1"></a><span class="co"># probability of joint exceendance under the baseline model</span></span>
<span id="cb47-2"><a href="Sec-CreditModel.html#cb47-2"></a><span class="kw">mean</span>(<span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(credit_data[, <span class="st">&quot;L2&quot;</span>] <span class="op">&gt;</span><span class="st"> </span>VaR.L2 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>) <span class="op">*</span><span class="st"> </span>(credit_data[, <span class="st">&quot;L3&quot;</span>] <span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb47-3"><a href="Sec-CreditModel.html#cb47-3"></a><span class="st">    </span>VaR.L3 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>))</span></code></pre></div>
<pre><code>## [1] 0.00865</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="Sec-CreditModel.html#cb49-1"></a><span class="co"># probability of joint exceendance under the stressed model</span></span>
<span id="cb49-2"><a href="Sec-CreditModel.html#cb49-2"></a><span class="kw">mean</span>(<span class="kw">get_weights</span>(stress.credit.L2L3) <span class="op">*</span><span class="st"> </span>(credit_data[, <span class="st">&quot;L2&quot;</span>] <span class="op">&gt;</span><span class="st"> </span>VaR.L2 <span class="op">*</span><span class="st"> </span></span>
<span id="cb49-3"><a href="Sec-CreditModel.html#cb49-3"></a><span class="st">    </span><span class="fl">1.2</span>) <span class="op">*</span><span class="st"> </span>(credit_data[, <span class="st">&quot;L3&quot;</span>] <span class="op">&gt;</span><span class="st"> </span>VaR.L3 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>))</span></code></pre></div>
<pre><code>## [1] 0.0308</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="Sec-CreditModel.html#cb51-1"></a><span class="co"># additionally stress joint exceedance probability of L2 and L3</span></span>
<span id="cb51-2"><a href="Sec-CreditModel.html#cb51-2"></a>f.stress.joint &lt;-<span class="st"> </span><span class="kw">c</span>(f.stress, <span class="cf">function</span>(x) <span class="dv">1</span> <span class="op">*</span><span class="st"> </span>(x[<span class="dv">1</span>] <span class="op">&gt;</span><span class="st"> </span>VaR.L2 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>) <span class="op">*</span><span class="st"> </span>(x[<span class="dv">2</span>] <span class="op">&gt;</span><span class="st"> </span></span>
<span id="cb51-3"><a href="Sec-CreditModel.html#cb51-3"></a><span class="st">    </span>VaR.L3 <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>))</span>
<span id="cb51-4"><a href="Sec-CreditModel.html#cb51-4"></a>stress.credit.L2L3 &lt;-<span class="st"> </span><span class="kw">stress_moment</span>(<span class="dt">x =</span> stress.credit.L2L3, <span class="dt">f =</span> f.stress.joint, </span>
<span id="cb51-5"><a href="Sec-CreditModel.html#cb51-5"></a>    <span class="dt">k =</span> <span class="kw">list</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)), <span class="dt">m =</span> <span class="kw">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.06</span>))</span></code></pre></div>
<p>We analyse the impact the stresses of the tail of the subportfolios <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> have on the aggregate portfolio <span class="math inline">\(L\)</span>. For this, we plot in Figure <a href="Sec-CreditModel.html#fig:CM-joint-stress-VaR-2-effect">4.4</a> the quantile of the aggregate portfolio under the baseline model (blue), under the stress on the tail of <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> (red), and under the additional stress on the joint tail of <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> (green).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="Sec-CreditModel.html#cb52-1"></a><span class="co"># stressed quantiles</span></span>
<span id="cb52-2"><a href="Sec-CreditModel.html#cb52-2"></a>VaR.level &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.75</span>, <span class="fl">0.99</span>, <span class="dt">by =</span> <span class="fl">0.003</span>)</span>
<span id="cb52-3"><a href="Sec-CreditModel.html#cb52-3"></a>VaR.stress1 &lt;-<span class="st"> </span><span class="kw">VaR_stressed</span>(stress.credit.L2L3, <span class="dt">alpha =</span> VaR.level, <span class="dt">xCol =</span> <span class="st">&quot;L&quot;</span>, </span>
<span id="cb52-4"><a href="Sec-CreditModel.html#cb52-4"></a>    <span class="dt">wCol =</span> <span class="dv">1</span>, <span class="dt">base =</span> <span class="ot">TRUE</span>)</span>
<span id="cb52-5"><a href="Sec-CreditModel.html#cb52-5"></a>VaR.stress2 &lt;-<span class="st"> </span><span class="kw">VaR_stressed</span>(stress.credit.L2L3, <span class="dt">alpha =</span> VaR.level, <span class="dt">xCol =</span> <span class="st">&quot;L&quot;</span>, </span>
<span id="cb52-6"><a href="Sec-CreditModel.html#cb52-6"></a>    <span class="dt">wCol =</span> <span class="dv">2</span>, <span class="dt">base =</span> <span class="ot">FALSE</span>)</span>
<span id="cb52-7"><a href="Sec-CreditModel.html#cb52-7"></a></span>
<span id="cb52-8"><a href="Sec-CreditModel.html#cb52-8"></a><span class="kw">plot</span>(VaR.level, VaR.stress1[, <span class="dv">2</span>], <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;quantile levels&quot;</span>, </span>
<span id="cb52-9"><a href="Sec-CreditModel.html#cb52-9"></a>    <span class="dt">ylab =</span> <span class="st">&quot;Quantiles of L under different models&quot;</span>)</span>
<span id="cb52-10"><a href="Sec-CreditModel.html#cb52-10"></a><span class="kw">lines</span>(VaR.level, VaR.stress1[, <span class="dv">1</span>], <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb52-11"><a href="Sec-CreditModel.html#cb52-11"></a><span class="kw">lines</span>(VaR.level, VaR.stress2, <span class="dt">col =</span> <span class="st">&quot;darkgreen&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:CM-joint-stress-VaR-2-effect"></span>
<img src="bookdown-SWIM_files/figure-html/CM-joint-stress-VaR-2-effect-1.png" alt="Quantiles of the aggregate loss $L$ under the baseline (blue), the stress on the tails of $L_2$ and $L_3$ (red), and the additional stress on the joint tail of $L_2$ and $L_3$ (green)." width="80%" />
<p class="caption">
Figure 4.4: Quantiles of the aggregate loss <span class="math inline">\(L\)</span> under the baseline (blue), the stress on the tails of <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> (red), and the additional stress on the joint tail of <span class="math inline">\(L_2\)</span> and <span class="math inline">\(L_3\)</span> (green).
</p>
</div>
<p>The results and the plots indicate that the additional stress on joint exceedances of subportfolios, increases the tail quantiles of <span class="math inline">\(L\)</span> even further, demonstrating the importance of (tail-)dependence in portfolio risk management.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Sec-Scope.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conclusion-and-future-work.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-SWIM.pdf"],
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
},
"search": true,
"css": "toc.css"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
