# (APPENDIX) Appendix {-}

# Appendix Creidt


This appendix discribes the Credit Model in Section \@ref(#Sec:CreditModel) and provides the code for generating the data.

The model considered is a simple variant of the conditionally binomial model described in +++Embrechts, Frey, Mc Neil+++ and belongs to the family of mixture models. The portfolio under study is split into three homogeneous subportfolios. For subportfolio $i$, $i=1,2,3$, we let

  - $m_i=$ portfolio size
  - $e_i=$ exposure
  - $p_i=$ common default probability
  - $\rho_i=$ common default correlation
  - $M_i=$ number of insolvencies
  - $L_i=$ aggregate loss
  - $LGD_i=$ loss given default 
 
The leading assumption is that, conditionally on $(H_1,H_2,H_3)$, the numbers of losses $(M_1,M_2,M_3)$ are independent and with Binomial$(n_i,H_i)$ distribution. The aggregate losses in each subportfolio and the overall loss are then defined by
\[L_i=e_i\cdot\text{LGD}_i\cdot M_i,\,i=1,2,3,\qquad L=L_1+L_2+L_3.\]

For $i=1,2,3$, $H_i\sim \text{beta}(\alpha_i,\beta_i)$, where the parameters $\alpha_i,\beta_i$ are chose so as to match the default probabilty $p_i$ and correlation $\rho_i$ in each subportfolio. The dependence structure of $(H_1,H_2,H_3)$ is modelled via a Gaussian+++ copula with correlation matrix +++

The following table resumes the parameter values adopted in the simulation

|$i$|$m_i$|$e_i$|$p_i$|$\rho_i$|$LGD_i$|
|------|------|------|------|------|------|
|1|2500|80|0.0004|0.00040|0.250|
|2|5000|25|0.0097|0.00440|0.375|
|3|2500|10|0.0503|0.01328|0.500|



```{r, eval=FALSE}
#simulation of the credit model data (this will be removed)
{
  library(SWIM)
  set.seed(1)
  library(copula)
  nsim <- 100000
  
  #data
  m1 <- 2500 # counterparties tranche A
  m2 <- 5000 # counterparties tranche B
  m3 <- 2500 # counterparties tranche C
  
  p1 <- 0.0004 # prob of default 
  rho1 <- 0.0004 # correlation within the tranche

  p2 <- 0.0097 
  rho2 <- 0.0044
  
  p3 <- 0.0503  
  rho3 <- 0.01328
  
  #exposures
  e1 <- 80
  e2 <- 25 
  e3 <- 10 
  
  #loss given default
  LGD1 <- 0.25
  LGD2 <- 0.375
  LGD3 <- 0.5
  
  # beta-binomial model with copula 
  
  # beta parameters: matching tranches default probabilities and correlation
  alpha1 <- p1 * (1 / rho1 - 1)
  beta1 <- alpha1 * (1 / p1 - 1)
  
  alpha2 <- p2 * (1 / rho2 - 1)
  beta2 <- alpha2 * (1 / p2 - 1)
  
  alpha3 <- p3 * (1 / rho3 - 1)
  beta3 <- alpha3 * (1 / p3 - 1)
  
  # correlations between tranches
  cor12 <- 0.3
  cor13 <- 0.1
  cor23 <- 0.4
  
  # Gaussian copula structure
  myCop <- normalCopula(param = c(cor12, cor13, cor23), dim = 3, dispstr = "un")
  
  # define multivariate beta with given copula
  myMvd <- mvdc(copula = myCop,
                margins = c("beta", "beta", "beta"),
                paramMargins = list(list(alpha1, beta1),
                                    list(alpha2, beta2),
                                    list(alpha3, beta3)))
  
  # simulation from the chosen copula
  H <- rMvdc(nsim, myMvd)
  
  #simulate number of default per tranches (binomial distributions)
  M1 <- rbinom(n = nsim, size = m1, prob = H[, 1])
  M2 <- rbinom(n = nsim, size = m2, prob = H[, 2])
  M3 <- rbinom(n = nsim, size = m3, prob = H[, 3])
  
  #total loss per tranches
  L1 <- M1 * e1 * LGD1
  L2 <- M2 * e2 * LGD2
  L3 <- M3 * e3 * LGD3
  
  #global loss
  L <- L1 + L2 + L3
  
  #DB for SWIM
  credit_data <- cbind(L, L1, L2, L3, H)
  colnames(credit_data) <- c("L", "L1", "L2", "L3", "H1", "H2", "H3")
  }
```




